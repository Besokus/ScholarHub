import{c as de,d as Ue,u as Pe,r as t,g as te,e as De,A as b,R as ae,Q as re,j as e,m as c,U as Le,C as Fe,S as le,h as Re,i as Qe}from"./index-742c88f7.js";import{U as $e}from"./uploads-caafdb77.js";import{S as _e}from"./sparkles-9df1855e.js";import{P as ie}from"./pen-line-9dd62d28.js";import{C as ne}from"./check-8f48b30b.js";import{M as He}from"./mail-5f89bb05.js";import{F as $}from"./file-text-ca3a3a77.js";import{U as Be}from"./upload-91c10940.js";import{D as Oe}from"./download-e6b51e37.js";import{A as Ve}from"./arrow-right-797056f3.js";import{A as Ge}from"./index-7dbfdcd6.js";import{C as We}from"./chevron-up-caf700bc.js";import{C as Xe}from"./chevron-down-aa962c16.js";/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ze=[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]],Je=de("credit-card",Ze);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ke=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M9 21V9",key:"1oto5p"}]],Ye=de("panels-top-left",Ke),oe=({checked:r,onChange:p,label:g,icon:l})=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg hover:bg-gray-50 transition-colors cursor-pointer",onClick:()=>p(!r),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-full ${r?"bg-indigo-100 text-indigo-600":"bg-gray-100 text-gray-500"}`,children:e.jsx(l,{size:18})}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:g})]}),e.jsx("div",{className:`w-11 h-6 flex items-center rounded-full p-1 duration-300 ease-in-out ${r?"bg-indigo-600":"bg-gray-300"}`,children:e.jsx("div",{className:`bg-white w-4 h-4 rounded-full shadow-md transform duration-300 ease-in-out ${r?"translate-x-5":""}`})})]}),qe=({text:r})=>e.jsxs("div",{className:"flex flex-col items-center justify-center py-10 text-gray-400 bg-gray-50/50 rounded-xl border border-dashed border-gray-200",children:[e.jsx("div",{className:"bg-white p-3 rounded-full mb-3 shadow-sm",children:e.jsx($,{size:20,className:"text-gray-300"})}),e.jsx("span",{className:"text-sm",children:r})]}),es=({title:r,icon:p,iconColorClass:g,items:l,renderItem:f,emptyText:y})=>{const[x,A]=t.useState(!1),d=5,w=l.length>d,z=x?l:l.slice(0,d);return e.jsxs(c.div,{layout:!0,className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6 flex flex-col h-full",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("h3",{className:"text-lg font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(p,{size:20,className:g})," ",r,e.jsx("span",{className:"bg-gray-100 text-gray-600 text-xs px-2 py-0.5 rounded-full ml-2 font-mono",children:l.length})]})}),e.jsx("div",{className:"flex-1",children:l.length>0?e.jsxs(e.Fragment,{children:[e.jsx("ul",{className:`space-y-3 transition-all duration-300 ease-in-out ${x?"max-h-[400px] overflow-y-auto pr-2 custom-scrollbar":""}`,children:e.jsx(Ge,{children:z.map((j,S)=>e.jsx(c.li,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,height:0},className:"group",children:f(j)},j.id||S))})}),w&&e.jsx("div",{className:"mt-4 pt-3 border-t border-gray-50 flex justify-center",children:e.jsx("button",{onClick:()=>A(!x),className:"text-sm text-indigo-600 hover:text-indigo-800 font-medium flex items-center gap-1 transition-colors px-4 py-1.5 rounded-full hover:bg-indigo-50",children:x?e.jsxs(e.Fragment,{children:["收起 ",e.jsx(We,{size:16})]}):e.jsxs(e.Fragment,{children:["查看全部 (",l.length-d," 条更多) ",e.jsx(Xe,{size:16})]})})})]}):e.jsx(qe,{text:y})})]})};function js(){const{show:r}=Ue(),p=Pe(),g=localStorage.getItem("id")||"2023123456",l=localStorage.getItem("role")||"STUDENT",[f,y]=t.useState(""),[x,A]=t.useState(""),[d,w]=t.useState(""),[z,j]=t.useState(!1),[S,_]=t.useState(""),[ce,E]=t.useState(!1),[xe,me]=t.useState(!0),[ue,he]=t.useState(!0),[pe,ge]=t.useState([]),[ss,fe]=t.useState([]),[be,ts]=t.useState(!1),[H,B]=t.useState(""),[m,O]=t.useState(""),[V,G]=t.useState(""),[je,W]=t.useState(null),[k,X]=t.useState(null),[I,Z]=t.useState(""),[as,ve]=t.useState(""),[u,Ne]=t.useState(""),[ye,M]=t.useState(!1),[we,J]=t.useState(!1),T=te.useMemo(()=>u?/^https?:\/\//.test(u)?u:`${De}${u.startsWith("/")?u:"/"+u}`:"",[u]),[U,Se]=t.useState(""),[K,Ce]=t.useState(""),[P,Y]=t.useState(1),[D,q]=t.useState([]),[rs,Ae]=t.useState(0),[h,ee]=t.useState(!1),[C,ze]=t.useState(!1),L=te.useRef(null),[ls,se]=t.useState([]);t.useEffect(()=>{b.me().then(s=>{var o,i,n,N;const a=((o=s.user)==null?void 0:o.username)||"";y(a),A(((i=s.user)==null?void 0:i.fullName)||""),w(a),Ne(((n=s.user)==null?void 0:n.avatar)||""),M(!!((N=s.user)!=null&&N.avatar)),J(!1)}).catch(()=>{}),ae.myUploads().then(s=>ge(s.items||[])).catch(()=>{}),ae.myDownloads().then(s=>fe(s.items||[])).catch(()=>{})},[g]),t.useEffect(()=>{const s=setTimeout(()=>Ce(U.trim()),300);return()=>clearTimeout(s)},[U]);const F=async(s,a)=>{if(!(h&&!a)){ee(!0);try{const i=await re.list({my:!0,page:s,pageSize:10,sort:K?"relevance":"time_desc"}),n=Array.isArray(i==null?void 0:i.items)?i.items:[],N=Number((i==null?void 0:i.total)||0);q(R=>a?n:[...R,...n]),Ae(N),ze(n.length===10),Y(s)}catch(o){console.error(o),a&&q([])}finally{ee(!1)}}};t.useEffect(()=>{F(1,!0)},[K]),t.useEffect(()=>{const s=new IntersectionObserver(a=>{a[0].isIntersecting&&C&&!h&&F(P+1,!1)},{threshold:.1});return L.current&&s.observe(L.current),()=>s.disconnect()},[C,h,P]),t.useEffect(()=>{re.list({my:!0,status:"open",page:1,pageSize:10}).then(s=>{const a=Array.isArray(s==null?void 0:s.items)?s.items:Array.isArray(s)?s:[];se(a)}).catch(()=>se([]))},[]);const Ee=async()=>{var s;if(!d.trim()||d===f)return E(!1);j(!0);try{const a=await b.updateUsername(d.trim());y(((s=a.user)==null?void 0:s.username)||d),_("用户名更新成功"),E(!1),setTimeout(()=>_(""),3e3)}catch{alert("修改失败")}finally{j(!1)}},ke={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1}}},v={hidden:{y:20,opacity:0},visible:{y:0,opacity:1}};return e.jsxs(c.div,{initial:"hidden",animate:"visible",variants:ke,className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 min-h-screen relative",children:[e.jsx("div",{className:"absolute top-0 left-0 w-full h-64 overflow-hidden -z-10 pointer-events-none",children:e.jsx("div",{className:"absolute top-[-50%] left-[-10%] w-96 h-96 bg-indigo-500/5 rounded-full blur-[100px]"})}),e.jsx("div",{className:"mb-10 relative",children:e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-500 font-medium",children:[e.jsxs("span",{className:"flex items-center gap-1.5 text-slate-400",children:[e.jsx(Le,{size:14})," 账户"]}),e.jsx(Fe,{size:14,className:"opacity-30"}),e.jsxs("span",{className:"text-indigo-600 bg-indigo-50 px-2 py-0.5 rounded-md flex items-center gap-1",children:[e.jsx(Ye,{size:12})," 个人中心"]})]}),e.jsx("div",{className:"flex flex-col md:flex-row md:items-end justify-between gap-4 mt-2",children:e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-extrabold text-slate-900 tracking-tight flex items-center gap-3",children:["个人中心",e.jsxs("span",{className:`inline-flex items-center gap-1 px-2.5 py-1 rounded-full text-xs font-bold border ${l==="TEACHER"?"bg-purple-50 text-purple-700 border-purple-200":"bg-emerald-50 text-emerald-700 border-emerald-200"}`,children:[l==="TEACHER"?e.jsx(Je,{size:12}):e.jsx(_e,{size:12}),l==="TEACHER"?"教师账户":"学生账户"]})]}),e.jsx("p",{className:"mt-2 text-slate-500 max-w-2xl text-base",children:"管理您的个人资料、安全设置以及查看您在 ScholarHub 的活动历史。"})]})})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-8 items-start",children:[e.jsxs("div",{className:"lg:col-span-4 space-y-6 sticky top-6",children:[e.jsxs(c.div,{variants:v,className:"bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden relative group",children:[e.jsxs("div",{className:"h-28 bg-gradient-to-r from-indigo-600 to-violet-600 relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 opacity-20 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')]"}),e.jsxs("button",{"aria-label":"打开设置",onClick:()=>p("/student/profile/settings"),className:"absolute top-3 right-3 px-3 py-2 rounded-lg bg-white/90 backdrop-blur-md border border-white/40 shadow-sm text-slate-700 hover:bg-white hover:text-indigo-200 transition-all flex items-center gap-2 focus:outline-none focus:ring-2 focus:ring-indigo-500",children:[e.jsx(le,{size:16})," 设置"]})]}),e.jsxs("div",{className:"px-6 pb-6",children:[e.jsx("div",{className:"relative -mt-12 mb-4 flex justify-between items-end",children:e.jsx("div",{className:"rounded-full border border-slate-200 bg-white shadow-lg overflow-hidden transform group-hover:scale-105 transition-transform duration-300 relative",style:{width:"120px",height:"120px"},children:T&&!we?e.jsxs(e.Fragment,{children:[ye&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"w-6 h-6 border-2 border-slate-300 border-t-indigo-600 rounded-full animate-spin"})}),e.jsx("img",{src:T,alt:"头像",loading:"lazy",decoding:"async",onLoad:()=>M(!1),onError:()=>{console.error("Avatar load error",T),J(!0),M(!1)},className:"w-full h-full object-cover"})]}):e.jsx("div",{className:"w-full h-full bg-gradient-to-br from-indigo-50 to-slate-100 flex items-center justify-center text-4xl font-black text-indigo-600 select-none",children:(x||f||"U")[0].toUpperCase()})})}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900",children:x||f}),e.jsxs("div",{className:"flex items-center gap-2 text-xs font-mono text-slate-400 bg-slate-50 px-2 py-1 rounded w-fit",children:[e.jsx("span",{children:"ID:"}),e.jsx("span",{className:"select-all",children:g})]})]}),e.jsxs("div",{className:"mt-6 pt-6 border-t border-gray-100",children:[e.jsxs("label",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider mb-2 block flex items-center gap-1",children:[e.jsx(ie,{size:10})," 显示名称"]}),ce?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{autoFocus:!0,className:"flex-1 px-3 py-2 bg-slate-50 border border-slate-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:bg-white transition-all",value:d,onChange:s=>w(s.target.value)}),e.jsx("button",{onClick:Ee,className:"p-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors shadow-sm",children:z?e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}):e.jsx(ne,{size:16})})]}):e.jsxs("div",{className:"flex items-center justify-between group/edit p-2 -mx-2 rounded-lg hover:bg-slate-50 transition-colors",children:[e.jsx("span",{className:"text-slate-700 font-medium",children:f}),l==="STUDENT"&&e.jsx("button",{onClick:()=>E(!0),className:"p-1.5 text-slate-400 hover:text-indigo-600 bg-white border border-slate-100 shadow-sm rounded-md opacity-0 group-hover/edit:opacity-100 transition-all",children:e.jsx(ie,{size:14})})]}),S&&e.jsxs("span",{className:"text-xs text-emerald-600 mt-2 flex items-center gap-1 font-medium",children:[e.jsx(ne,{size:12})," ",S]})]})]})]}),e.jsxs(c.div,{variants:v,className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6",children:[e.jsxs("h3",{className:"text-lg font-bold text-slate-800 mb-4 flex items-center gap-2",children:[e.jsx(Re,{size:20,className:"text-indigo-500"})," 偏好设置"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(oe,{label:"邮件通知",icon:He,checked:xe,onChange:me}),e.jsx(oe,{label:"界面徽章提醒",icon:Qe,checked:ue,onChange:he})]})]})]}),e.jsxs("div",{className:"lg:col-span-8",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsxs(c.div,{variants:v,className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-bold text-slate-800 flex items-center gap-2",children:[e.jsx($,{size:20,className:"text-indigo-500"})," 我的提问"]}),e.jsx("input",{value:U,onChange:s=>{Se(s.target.value),Y(1)},placeholder:"搜索我的提问",className:"px-3 py-2 bg-slate-50 border border-slate-200 rounded-lg text-sm"})]}),e.jsx("ul",{className:"space-y-2",children:D.map((s,a)=>e.jsxs("li",{className:"p-3 rounded-xl hover:bg-slate-50 border border-transparent hover:border-slate-200 transition-all cursor-pointer",onClick:()=>p(`/student/qa/${s.id||s.questionId}`),children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex items-center min-w-0",children:[e.jsx("h4",{className:"font-bold text-slate-800 truncate pr-1 text-sm",children:s.title||s.content||"未命名问题"}),e.jsx("span",{className:`ml-1 rounded-full ${(s==null?void 0:s.status)==="solved"?"bg-emerald-500":"bg-amber-400"} md:w-2 md:h-2 w-[6px] h-[6px]`,title:(s==null?void 0:s.status)==="solved"?"已解决":"未解决"})]}),e.jsx("span",{className:"text-xs text-slate-400 shrink-0 whitespace-nowrap bg-slate-50 px-1.5 py-0.5 rounded",children:s.createdAt?new Date(s.createdAt).toLocaleDateString():s.time?new Date(s.time).toLocaleDateString():""})]}),e.jsx("div",{className:"text-xs text-slate-500 mt-1.5",children:s.courseId||""})]},s.id||a))}),D.length===0&&!h&&e.jsx("div",{className:"text-sm text-slate-500 py-10 text-center",children:"暂无提问记录"}),e.jsxs("div",{ref:L,className:"mt-4 py-4 flex justify-center items-center gap-2 min-h-[40px]",children:[h&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-slate-300 border-t-indigo-600 rounded-full animate-spin"}),e.jsx("span",{className:"text-xs text-slate-400",children:"加载中..."})]}),!h&&C&&e.jsx("span",{className:"text-xs text-slate-400 cursor-pointer hover:text-indigo-600",onClick:()=>F(P+1,!1),children:"下滑或点击加载更多"}),!h&&!C&&D.length>0&&e.jsx("span",{className:"text-xs text-slate-400",children:"已加载全部"})]})]}),e.jsxs("div",{className:"md:col-span-1 space-y-6",children:[!1,e.jsx(c.div,{variants:v,children:e.jsx(es,{title:"我的上传",icon:Be,iconColorClass:"text-blue-500",items:pe,emptyText:"暂无上传记录，快去分享你的第一份资料吧！",renderItem:s=>e.jsxs("div",{className:"flex items-center p-3 rounded-xl hover:bg-slate-50 border border-transparent hover:border-slate-200 transition-all cursor-pointer",children:[e.jsx("div",{className:"bg-blue-50 text-blue-600 p-2.5 rounded-xl mr-4 shrink-0 border border-blue-100",children:e.jsx($,{size:18})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("h4",{className:"font-bold text-slate-800 truncate pr-2 text-sm",children:s.title}),e.jsx("span",{className:"text-xs text-slate-400 shrink-0 whitespace-nowrap bg-slate-50 px-1.5 py-0.5 rounded",children:s.time?new Date(s.time).toLocaleDateString():"刚刚"})]}),e.jsxs("div",{className:"flex items-center gap-3 mt-1.5 text-xs text-slate-500",children:[e.jsx("span",{className:"bg-slate-100 px-2 py-0.5 rounded text-slate-600 font-medium",children:s.courseId}),s.downloads!==void 0&&e.jsxs("span",{className:"flex items中心 gap-1",children:[e.jsx(Oe,{size:10})," ",s.downloads]})]})]}),e.jsx("div",{className:"ml-2 text-slate-300",children:e.jsx(Ve,{size:16})})]})})})]})]}),be&&e.jsxs(c.div,{variants:v,className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6",children:[e.jsxs("h3",{className:"text-lg font-bold text-slate-800 mb-4 flex items-center gap-2",children:[e.jsx(le,{size:20,className:"text-indigo-500"})," 账户设置"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"border border-slate-100 rounded-xl p-4",children:[e.jsx("h4",{className:"text-sm font-bold text-slate-700 mb-3",children:"密码修改"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{value:H,onChange:s=>B(s.target.value),type:"password",placeholder:"当前密码",className:"w-full px-3 py-2 bg-slate-50 border border-slate-200 rounded-lg text-sm"}),e.jsx("input",{value:m,onChange:s=>O(s.target.value),type:"password",placeholder:"新密码（至少8位，含大小写与数字）",className:"w-full px-3 py-2 bg-slate-50 border border-slate-200 rounded-lg text-sm"}),e.jsx("input",{value:V,onChange:s=>G(s.target.value),type:"password",placeholder:"确认新密码",className:"w-full px-3 py-2 bg-slate-50 border border-slate-200 rounded-lg text-sm"}),e.jsx("button",{onClick:async()=>{if(!(m.length>=8&&/[A-Z]/.test(m)&&/[a-z]/.test(m)&&/[0-9]/.test(m))){r("密码强度不足","error");return}if(m!==V){r("两次输入不一致","error");return}try{await b.updatePassword(H,m),r("密码已更新","success"),B(""),O(""),G("")}catch(a){r((a==null?void 0:a.message)||"更新失败","error")}},className:"px-3 py-2 bg-indigo-600 text-white rounded-lg text-sm font-semibold",children:"保存"})]})]}),e.jsxs("div",{className:"border border-slate-100 rounded-xl p-4",children:[e.jsx("h4",{className:"text-sm font-bold text-slate-700 mb-3",children:"头像上传"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:s=>{var o;const a=((o=s.target.files)==null?void 0:o[0])||null;W(a),X(a?URL.createObjectURL(a):null)}}),k&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:k,alt:"预览",className:"w-20 h-20 rounded-xl object-cover"}),e.jsx("button",{onClick:async()=>{if(!je)return;const s=document.createElement("img");s.src=k,await new Promise(Q=>{s.onload=()=>Q(null)});const a=Math.min(s.width,s.height),o=Math.floor((s.width-a)/2),i=Math.floor((s.height-a)/2),n=document.createElement("canvas");n.width=a,n.height=a,n.getContext("2d").drawImage(s,o,i,a,a,0,0,a,a);const R=await new Promise(Q=>n.toBlob(Te=>Q(Te),"image/jpeg",.9)),Ie=new File([R],"avatar.jpg",{type:"image/jpeg"}),Me=await $e.uploadFile(Ie);await b.updateAvatar(Me.url),r("头像已更新","success"),W(null),X(null)},className:"px-3 py-2 bg-indigo-600 text-white rounded-lg text-sm font-semibold",children:"裁剪为中心方形并保存"})]})]})]}),e.jsxs("div",{className:"border border-slate-100 rounded-xl p-4",children:[e.jsx("h4",{className:"text-sm font-bold text-slate-700 mb-3",children:"邮箱修改"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{value:I,onChange:s=>Z(s.target.value),placeholder:"新邮箱",className:"w-full px-3 py-2 bg-slate-50 border border-slate-200 rounded-lg text-sm"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:async()=>{try{const s=await b.emailCheck(I);s!=null&&s.valid?r("邮箱格式与MX记录验证通过","success"):r((s==null?void 0:s.reason)||"邮箱验证失败","error")}catch(s){r((s==null?void 0:s.message)||"验证失败","error")}},className:"px-3 py-2 bg-white border border-slate-200 rounded-lg text-sm",children:"验证邮箱"}),e.jsx("button",{onClick:async()=>{try{await b.updateEmail(I),r("邮箱已更新","success"),Z(""),ve("")}catch(s){r((s==null?void 0:s.message)||"更新失败","error")}},className:"px-3 py-2 bg-indigo-600 text-white rounded-lg text-sm",children:"保存"})]})]})]})]})]})]})]})]})}export{js as default};
