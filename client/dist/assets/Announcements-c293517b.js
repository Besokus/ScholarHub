import{r as a,j as e,s as v}from"./index-742c88f7.js";import{P,C as j}from"./Card-80a76d03.js";import{P as D}from"./Pagination-1c3acbf2.js";import"./chevron-left-0e1b0896.js";function I(m){const u=m.split(`
`),l=[];let c=!1;const n=i=>i.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),x=i=>{let t=i.replace(/\*\*([^\*]+)\*\*/g,"<b>$1</b>");return t=t.replace(/\*([^*]+)\*/g,"<i>$1</i>"),n(t)};for(const i of u){const t=i;if(t.trim().startsWith("```")){c?(l.push("</code></pre>"),c=!1):(l.push("<pre><code>"),c=!0);continue}if(c){l.push(n(t));continue}if(t.startsWith("# ")){l.push("<h1>"+n(t.slice(2))+"</h1>");continue}if(t.startsWith("## ")){l.push("<h2>"+n(t.slice(3))+"</h2>");continue}if(t.startsWith("### ")){l.push("<h3>"+n(t.slice(4))+"</h3>");continue}const r=x(t);l.push("<p>"+r+"</p>")}return c&&l.push("</code></pre>"),l.join(`
`)}function z(){const[m,u]=a.useState([]),[l,c]=a.useState(0),[n,x]=a.useState(1),[i,t]=a.useState(""),[r,N]=a.useState(""),[d,f]=a.useState(""),[b,y]=a.useState("ALL"),[w,S]=a.useState("NORMAL"),[C,A]=a.useState(!1),[h,L]=a.useState(""),[g,E]=a.useState(""),k=a.useMemo(()=>I(d),[d]),p=async(s=n)=>{var M,R;const o=await v.announcements.list({severity:i,page:s,pageSize:10}),W=((M=o.Data)==null?void 0:M.items)||o.items||[],G=((R=o.Data)==null?void 0:R.total)??o.total??0;u(W),c(G),x(s)};a.useEffect(()=>{p(1)},[i]);const T=async()=>{const s=h?new Date(h).getTime():null,o=g?new Date(g).getTime():null;await v.announcements.create({title:r,markdown:d,scope:b,severity:w,validFrom:s,validTo:o,pinned:C}),N(""),f(""),y("ALL"),S("NORMAL"),A(!1),L(""),E(""),await p(1)};return e.jsxs("div",{className:"p-6 md:p-8 max-w-7xl mx-auto",children:[e.jsx(P,{title:"系统公告",subtitle:"发布与管理公告",right:e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("select",{value:i,onChange:s=>t(s.target.value),className:"px-3 py-2 border rounded-lg",children:[e.jsx("option",{value:"",children:"全部级别"}),e.jsx("option",{value:"NORMAL",children:"一般"}),e.jsx("option",{value:"WARNING",children:"预警"}),e.jsx("option",{value:"EMERGENCY",children:"紧急"})]})})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs(j,{className:"p-6 space-y-4",children:[e.jsx("div",{className:"text-lg font-semibold text-slate-800",children:"发布公告"}),e.jsx("input",{value:r,onChange:s=>N(s.target.value),placeholder:"标题",className:"w-full px-3 py-2 border rounded-lg"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("select",{value:b,onChange:s=>y(s.target.value),className:"px-3 py-2 border rounded-lg",children:e.jsx("option",{value:"ALL",children:"全体学生"})}),e.jsxs("select",{value:w,onChange:s=>S(s.target.value),className:"px-3 py-2 border rounded-lg",children:[e.jsx("option",{value:"NORMAL",children:"一般"}),e.jsx("option",{value:"WARNING",children:"预警"}),e.jsx("option",{value:"EMERGENCY",children:"紧急"})]}),e.jsxs("label",{className:"inline-flex items-center gap-2 ml-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:C,onChange:s=>A(s.target.checked)}),"置顶"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("input",{type:"datetime-local",value:h,onChange:s=>L(s.target.value),className:"px-3 py-2 border rounded-lg"}),e.jsx("input",{type:"datetime-local",value:g,onChange:s=>E(s.target.value),className:"px-3 py-2 border rounded-lg"})]}),e.jsx("textarea",{value:d,onChange:s=>f(s.target.value),placeholder:"Markdown 内容",className:"w-full px-3 py-2 border rounded-lg h-48"}),e.jsx("div",{className:"flex items-center justify-end",children:e.jsx("button",{onClick:T,className:"px-4 py-2 bg-indigo-600 text-white rounded-lg",children:"发布"})})]}),e.jsxs(j,{className:"p-6",children:[e.jsx("div",{className:"text-lg font-semibold text-slate-800 mb-3",children:"实时预览"}),e.jsx("div",{className:"prose max-w-none",dangerouslySetInnerHTML:{__html:k}})]})]}),e.jsxs("div",{className:"mt-10",children:[e.jsx("div",{className:"text-lg font-semibold text-slate-800 mb-3",children:"公告列表"}),e.jsx("div",{className:"space-y-4",children:m.map(s=>e.jsx(j,{className:"p-5",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-lg font-bold text-slate-800",children:s.title}),e.jsx("div",{className:"text-xs text-slate-500 mt-1",children:new Date(s.publishAt).toLocaleString()}),e.jsxs("div",{className:"mt-2 text-xs",children:[e.jsx("span",{className:`px-2 py-1 rounded-full ${s.severity==="EMERGENCY"?"bg-rose-100 text-rose-700":s.severity==="WARNING"?"bg-amber-100 text-amber-700":"bg-slate-100 text-slate-600"}`,children:s.severity}),e.jsx("span",{className:"ml-2 text-slate-400",children:s.scope}),s.pinned&&e.jsx("span",{className:"ml-2 px-2 py-1 rounded-full bg-indigo-100 text-indigo-700",children:"置顶"})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{className:"px-3 py-1 bg-slate-100 text-slate-700 rounded-lg",onClick:async()=>{await v.announcements.remove(s.id),await p(n)},children:"删除"})})]})},s.id))}),e.jsx(D,{page:n,pageSize:10,total:l,onChange:s=>p(s)})]})]})}export{z as default};
