import{r as m,N as u,a as p,u as w,j as t}from"./index-742c88f7.js";import{P as j,C as f}from"./Card-80a76d03.js";function b(){const[s,c]=m.useState([]),i=m.useRef(null),e=async()=>{var n;try{const l=await u.unreadAnswers().catch(()=>({items:[]})),d=await p.list({status:"unread",page:1,pageSize:20}).catch(()=>({items:[]})),y=(l.items||[]).map(a=>({id:String(a.id),type:"answer",title:a.title,createdAt:Number(a.createdAt||Date.now()),read:!!a.read,questionId:String(a.questionId||"")})),h=(d.items||((n=d.Data)==null?void 0:n.items)||[]).map(a=>({id:String(a.id),type:"announcement",title:a.title,createdAt:new Date(a.publishAt).getTime(),read:!!a.read,severity:String(a.severity||"NORMAL"),pinned:!!a.pinned})),x=[...y,...h].filter(Boolean);x.sort((a,o)=>{const g=a.type==="announcement"&&a.pinned,N=o.type==="announcement"&&o.pinned;return g!==N?g?-1:1:o.createdAt-a.createdAt}),c(x)}catch{}};m.useEffect(()=>(e(),i.current=window.setInterval(e,15e3),()=>{i.current&&window.clearInterval(i.current)}),[]);const r=async n=>{try{n.type==="answer"?await u.markRead(n.id):await p.markRead(n.id)}catch{}c(l=>l.filter(d=>d.id!==n.id))};return{unread:s,count:s.length,markRead:r}}function R(){const{unread:s,markRead:c}=b(),i=w();return t.jsxs("div",{children:[t.jsx(j,{title:"通知提醒",subtitle:"教师回答与系统消息"}),t.jsxs("div",{className:"space-y-4",children:[t.jsx("div",{className:"flex items-center justify-end",children:t.jsx("button",{className:"px-3 py-1 bg-indigo-600 text-white rounded-lg text-sm",onClick:async()=>{try{await u.readAll();const e=s.filter(r=>r.type==="announcement").map(r=>r.id);e.length&&await p.markReadBatch(e)}catch{}},children:"全部标记已读"})}),s.map(e=>t.jsx(f,{className:"p-6",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:`text-[10px] px-2 py-0.5 rounded-full font-bold uppercase ${e.type==="announcement"?e.severity==="EMERGENCY"?"bg-rose-100 text-rose-700":e.severity==="WARNING"?"bg-amber-100 text-amber-700":"bg-slate-100 text-slate-600":"bg-emerald-100 text-emerald-700"}`,children:e.type==="announcement"?"Announcement":"New Answer"}),e.type==="announcement"&&e.pinned&&t.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded-full font-bold uppercase bg-indigo-100 text-indigo-700",children:"置顶"}),t.jsx("span",{className:"font-semibold text-gray-800",children:e.title})]}),t.jsx("div",{className:"text-sm text-gray-500 mt-1",children:new Date(e.createdAt).toLocaleString()})]}),t.jsx("div",{className:"flex items-center gap-2",children:t.jsx("button",{className:"px-3 py-1 bg-indigo-600 text-white rounded-lg",onClick:()=>{c(e),e.type==="answer"?i(`/student/qa/${e.questionId}`):i(`/student/announcements/${e.id}`)},children:"查看"})})]})},e.id)),s.length===0&&t.jsx(f,{className:"p-6",children:t.jsx("div",{className:"text-gray-600",children:"暂无未读通知"})})]})]})}export{R as default};
