import{r as s,j as e,m as C,L as S,A as E}from"./index-742c88f7.js";import{A as F}from"./arrow-left-83ee801f.js";import{M as I}from"./mail-5f89bb05.js";import{C as B}from"./circle-check-135a219a.js";import{C as H}from"./circle-alert-dad2e7a8.js";const J=()=>{const[o,A]=s.useState(""),[u,x]=s.useState(""),[h,k]=s.useState(!1),[i,l]=s.useState(!1),[d,r]=s.useState(null),b=s.useMemo(()=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(o.trim()),[o]),[P,L]=s.useState("request"),[m,M]=s.useState(""),[a,q]=s.useState(""),[w,z]=s.useState(""),[y,j]=s.useState(""),[v,c]=s.useState(""),[p,g]=s.useState(0),_=async()=>{if(r(null),!b){x("请输入有效的邮箱地址");return}if(!h){r({type:"error",text:"请完成人机验证"});return}l(!0);try{const t=await E.sendEmailCode(o.trim()),n=t&&t.next_request?Number(t.next_request):60;g(n);const f=setInterval(()=>g(N=>N<=1?(clearInterval(f),0):N-1),1e3);r({type:"success",text:"验证码已发送至您的邮箱"}),L("confirm")}catch(t){const n=t&&t.data&&t.data.retry_after?Number(t.data.retry_after):60;g(n),r({type:"error",text:"请求过于频繁，请稍后再试"})}finally{l(!1)}},$=async()=>{r(null);const t=a.length>=8&&/[A-Z]/.test(a)&&/[a-z]/.test(a)&&/[0-9]/.test(a);if(!/^\d{6}$/.test(m)){j("请输入6位数字验证码");return}if(!t){c("密码需至少8位，包含大小写字母和数字");return}if(a!==w){c("两次输入的密码不一致");return}l(!0);try{await E.resetPasswordConfirm(o.trim(),m.trim(),a),r({type:"success",text:"密码修改成功"})}catch(n){const f=(n==null?void 0:n.message)||"验证码错误或已过期";r({type:"error",text:f})}finally{l(!1)}};return e.jsx("div",{className:"min-h-screen w-full flex items-center justify-center bg-slate-50 px-6 py-12",children:e.jsxs(C.div,{initial:{opacity:0,y:16},animate:{opacity:1,y:0},className:"w-full max-w-md bg-white rounded-2xl border border-slate-200 shadow-sm p-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h1",{className:"text-xl font-bold text-slate-800",children:"忘记密码"}),e.jsxs("a",{href:"/login",className:"text-xs text-indigo-600 font-semibold flex items-center gap-1",children:[e.jsx(F,{size:12})," 返回登录"]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(I,{className:"absolute left-4 top-3.5 h-5 w-5 text-slate-400"}),e.jsx("input",{type:"email",value:o,onChange:t=>{A(t.target.value),u&&x("")},onBlur:()=>x(b?"":"请输入有效的邮箱地址"),placeholder:"注册邮箱",className:"w-full pl-11 pr-4 py-3 bg-white border border-slate-200 rounded-xl focus:bg-white focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 outline-none transition-all placeholder:text-slate-400"}),u&&e.jsx("div",{className:"mt-2 text-xs text-rose-600 font-medium",children:u})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm text-slate-600",children:[e.jsx("input",{type:"checkbox",checked:h,onChange:t=>k(t.target.checked),className:"rounded"}),"我不是机器人"]}),d&&e.jsxs(C.div,{initial:{opacity:0,y:-8},animate:{opacity:1,y:0},className:`p-3 rounded-lg flex items-center gap-2 text-sm font-medium ${d.type==="success"?"bg-green-50 text-green-700 border border-green-100":"bg-rose-50 text-rose-700 border border-rose-100"}`,children:[d.type==="success"?e.jsx(B,{size:18}):e.jsx(H,{size:18}),d.text]}),P==="request"?e.jsx("button",{onClick:_,disabled:i||p>0,className:"w-full py-3.5 px-4 bg-indigo-600 hover:bg-indigo-500 text-white rounded-xl font-bold shadow-lg disabled:opacity-70 disabled:cursor-not-allowed flex items-center justify-center gap-2 transition-all",children:i?e.jsxs(e.Fragment,{children:[e.jsx(S,{className:"animate-spin h-5 w-5"}),e.jsx("span",{children:"发送中..."})]}):e.jsx("span",{children:p>0?`重新发送(${p}s)`:"发送验证码"})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("input",{type:"text",inputMode:"numeric",maxLength:6,value:m,onChange:t=>{M(t.target.value.replace(/[^0-9]/g,"")),j("")},placeholder:"输入6位验证码",className:"w-full px-4 py-3 bg-white border border-slate-200 rounded-xl focus:bg-white focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 outline-none transition-all"}),y&&e.jsx("div",{className:"mt-2 text-xs text-rose-600 font-medium",children:y})]}),e.jsx("div",{children:e.jsx("input",{type:"password",value:a,onChange:t=>{q(t.target.value),c("")},placeholder:"设置新密码",className:"w-full px-4 py-3 bg-white border border-slate-200 rounded-xl focus:bg-white focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 outline-none transition-all"})}),e.jsxs("div",{children:[e.jsx("input",{type:"password",value:w,onChange:t=>{z(t.target.value),c("")},placeholder:"确认新密码",className:"w-full px-4 py-3 bg-white border border-slate-200 rounded-xl focus:bg-white focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 outline-none transition-all"}),v&&e.jsx("div",{className:"mt-2 text-xs text-rose-600 font-medium",children:v})]}),e.jsx("button",{onClick:$,disabled:i,className:"w-full py-3.5 px-4 bg-indigo-600 hover:bg-indigo-500 text-white rounded-xl font-bold shadow-lg disabled:opacity-70 disabled:cursor-not-allowed flex items-center justify-center gap-2 transition-all",children:i?e.jsxs(e.Fragment,{children:[e.jsx(S,{className:"animate-spin h-5 w-5"}),e.jsx("span",{children:"提交中..."})]}):e.jsx("span",{children:"确认修改密码"})})]}),e.jsx("div",{className:"text-xs text-slate-500 text-center",children:"发送成功后，请查收邮箱中的验证码。如未收到，检查垃圾邮件或稍后重试。"})]})]})})};export{J as default};
