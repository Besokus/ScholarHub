import{c as v,d as U,l as A,u as I,r as d,g as F,j as e,C as _,e as b,U as M,R as u}from"./index-742c88f7.js";import{R as O}from"./RichText-8c20a8cd.js";import{A as H}from"./arrow-left-83ee801f.js";import{L as Z}from"./layers-ac6640bf.js";import{S as G}from"./share-2-d2cc455f.js";import{F as c}from"./file-text-ca3a3a77.js";import{S as X}from"./shield-check-ab443cd1.js";import{D as Y}from"./download-e6b51e37.js";import{E as J}from"./external-link-ba10794c.js";import{C as V}from"./clock-a684511e.js";import{E as W}from"./eye-6021bed5.js";import{I as f}from"./image-703b1c2d.js";import{P as m,M as q}from"./package-8be94a66.js";import{a as B,F as K}from"./file-151d33f9.js";/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]],ee=v("ellipsis",Q);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=[["line",{x1:"22",x2:"2",y1:"12",y2:"12",key:"1y58io"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}],["line",{x1:"6",x2:"6.01",y1:"16",y2:"16",key:"sgf278"}],["line",{x1:"10",x2:"10.01",y1:"16",y2:"16",key:"1l4acy"}]],te=v("hard-drive",se),j={PDF:{bg:"bg-rose-50",text:"text-rose-600",icon:c},JPG:{bg:"bg-indigo-50",text:"text-indigo-600",icon:f},PNG:{bg:"bg-indigo-50",text:"text-indigo-600",icon:f},ZIP:{bg:"bg-amber-50",text:"text-amber-600",icon:m},RAR:{bg:"bg-amber-50",text:"text-amber-600",icon:m},"7Z":{bg:"bg-amber-50",text:"text-amber-600",icon:m},MP4:{bg:"bg-sky-50",text:"text-sky-600",icon:B},MP3:{bg:"bg-emerald-50",text:"text-emerald-600",icon:q},DOCX:{bg:"bg-blue-50",text:"text-blue-600",icon:c},PPTX:{bg:"bg-orange-50",text:"text-orange-600",icon:c},DEFAULT:{bg:"bg-slate-50",text:"text-slate-600",icon:K}};function ue(){const{show:o}=U(),{id:r}=A(),p=I(),[N,g]=d.useState(0),[y,h]=d.useState(!0),[s,w]=d.useState({title:"",uploader:{name:""},size:"",type:"",summary:"",fileUrl:"",createTime:"",viewCount:0}),x=F.useRef(null);d.useEffect(()=>{(async()=>{if(r&&x.current!==r){x.current=r;try{h(!0);const t=await u.detail(r);w({title:t.title,uploader:{name:t.uploaderName||"未知用户"},size:t.size||"未知",type:(t.type||"FILE").toUpperCase(),summary:t.summary,fileUrl:t.fileUrl||"",createTime:t.createdAt||t.createTime,viewCount:t.viewCount||0}),g(t.downloadCount||0)}catch{o("资源加载失败","error"),x.current=null}finally{h(!1)}}})()},[r]);const k=()=>{if(!r||!s.fileUrl)return;u.downloadLog(String(r)).catch(()=>{});const a=document.createElement("a");a.href=`${b}/api/resources/${r}/download`,a.target="_blank",document.body.appendChild(a),a.click(),document.body.removeChild(a),g(t=>t+1);try{window.dispatchEvent(new CustomEvent("SH_STATS_UPDATED"))}catch{}o("开始下载...","success")},C=a=>{["ZIP","RAR","7Z","PPT","PPTX"].includes(s.type)&&(a.preventDefault(),o("该资源不支持在线查看，请直接下载","error"))},z=()=>{navigator.clipboard.writeText(window.location.href),o("链接已复制到剪贴板","success")},P=a=>{if(!a)return"-";const t=String(a);if(/^\d{4}-\d{2}-\d{2} \d{2}:\d{2}$/.test(t))return t;const i=new Date(a),n=L=>String(L).padStart(2,"0"),D=i.getFullYear(),E=n(i.getMonth()+1),S=n(i.getDate()),$=n(i.getHours()),R=n(i.getMinutes());return`${D}-${E}-${S} ${$}:${R}`},l=j[s.type]||j.DEFAULT,T=l.icon;return y?e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 py-8 animate-pulse",children:[e.jsx("div",{className:"h-8 w-1/3 bg-slate-200 rounded mb-8"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:[e.jsx("div",{className:"md:col-span-2 h-96 bg-slate-100 rounded-3xl"}),e.jsx("div",{className:"h-64 bg-slate-100 rounded-3xl"})]})]}):e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 py-8 min-h-screen",children:[e.jsxs("div",{className:"flex flex-col gap-4 mb-8",children:[e.jsxs("div",{className:"flex items-center gap-3 text-sm text-slate-500 font-medium",children:[e.jsx("button",{onClick:()=>p(-1),className:"p-1.5 rounded-lg hover:bg-slate-100 hover:text-slate-700 transition-colors",children:e.jsx(H,{size:16})}),e.jsx("div",{className:"w-px h-3 bg-slate-300"}),e.jsxs("span",{className:"flex items-center gap-1 hover:text-indigo-600 cursor-pointer transition-colors",onClick:()=>p("/student/resources"),children:[e.jsx(Z,{size:14})," 资源中心"]}),e.jsx(_,{size:14,className:"opacity-50"}),e.jsx("span",{className:"text-indigo-600 font-semibold bg-indigo-50 px-2 py-0.5 rounded-md",children:"详情"})]}),e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsx("h1",{className:"text-3xl font-extrabold text-slate-900 tracking-tight leading-tight max-w-3xl",children:s.title}),e.jsxs("div",{className:"hidden md:flex gap-2",children:[e.jsx("button",{onClick:z,className:"p-2.5 bg-white border border-slate-200 text-slate-500 rounded-xl hover:bg-slate-50 hover:text-indigo-600 transition-colors shadow-sm",title:"分享链接",children:e.jsx(G,{size:18})}),e.jsx("button",{className:"p-2.5 bg-white border border-slate-200 text-slate-500 rounded-xl hover:bg-slate-50 transition-colors shadow-sm",children:e.jsx(ee,{size:18})})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-8 items-start",children:[e.jsxs("div",{className:"lg:col-span-8 space-y-8",children:[e.jsxs("div",{className:"bg-white rounded-[2rem] p-8 shadow-sm border border-slate-100 flex items-center gap-6 relative overflow-hidden",children:[e.jsx("div",{className:`absolute right-0 top-0 w-64 h-64 opacity-5 rounded-full blur-3xl -mr-16 -mt-16 ${l.bg.replace("bg-","bg-current text-")}`}),e.jsx("div",{className:`w-20 h-20 rounded-2xl flex items-center justify-center shadow-sm shrink-0 ${l.bg} ${l.text}`,children:e.jsx(T,{size:40,strokeWidth:1.5})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("span",{className:`px-2.5 py-1 rounded-lg text-xs font-bold tracking-wide ${l.bg} ${l.text}`,children:s.type}),e.jsx("span",{className:"text-xs text-slate-400 font-medium bg-slate-50 px-2 py-1 rounded-lg",children:s.size})]}),e.jsxs("p",{className:"text-sm text-slate-500 line-clamp-2",children:[s.summary.replace(/<[^>]+>/g,"").slice(0,80),"..."]})]})]}),e.jsxs("div",{className:"bg-white rounded-[2rem] p-8 shadow-sm border border-slate-100 min-h-[400px]",children:[e.jsxs("h3",{className:"text-lg font-bold text-slate-800 mb-6 flex items-center gap-2",children:[e.jsx(c,{size:20,className:"text-indigo-500"})," 资源简介"]}),e.jsx("div",{className:"prose prose-slate prose-indigo max-w-none prose-p:text-slate-600 prose-headings:font-bold prose-a:text-indigo-600",children:e.jsx(O,{value:s.summary,readOnly:!0})}),e.jsxs("div",{className:"mt-12 pt-6 border-t border-slate-100 flex items-center gap-3 text-xs text-slate-400",children:[e.jsx(X,{size:16,className:"text-emerald-500"}),e.jsx("span",{children:"该资源已通过系统安全扫描，请放心下载使用。"})]})]})]}),e.jsxs("div",{className:"lg:col-span-4 space-y-6 sticky top-6",children:[e.jsxs("div",{className:"bg-white rounded-[2rem] p-6 shadow-lg shadow-indigo-100/50 border border-slate-100",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"text-3xl font-extrabold text-slate-900 font-mono tracking-tight",children:N}),e.jsx("div",{className:"text-xs text-slate-400 font-medium uppercase tracking-wider mt-1",children:"Total Downloads"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:k,className:"w-full flex items-center justify-center gap-2 px-6 py-3.5 bg-indigo-600 hover:bg-indigo-700 text-white rounded-xl font-bold shadow-lg shadow-indigo-200 transition-all active:scale-95 group",children:[e.jsx(Y,{size:20,className:"group-hover:animate-bounce"}),"立即下载"]}),s.fileUrl&&e.jsxs("a",{href:`${b}${s.fileUrl}`,target:"_blank",rel:"noreferrer",onClick:C,className:"w-full flex items-center justify-center gap-2 px-6 py-3.5 bg-white border-2 border-slate-100 text-slate-600 hover:border-indigo-100 hover:text-indigo-600 rounded-xl font-bold transition-all active:scale-95",children:[e.jsx(J,{size:18}),"在线预览"]})]})]}),e.jsxs("div",{className:"bg-white rounded-[2rem] p-6 shadow-sm border border-slate-100",children:[e.jsx("h4",{className:"text-sm font-bold text-slate-800 mb-4 px-1",children:"基本信息"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-3 bg-slate-50 rounded-2xl border border-slate-100",children:[e.jsx("div",{className:"text-slate-400 mb-1",children:e.jsx(M,{size:16})}),e.jsx("div",{className:"text-[10px] text-slate-400 uppercase font-bold",children:"UpLoader"}),e.jsx("div",{className:"font-semibold text-slate-700 text-sm truncate",title:s.uploader.name,children:s.uploader.name})]}),e.jsxs("div",{className:"p-3 bg-slate-50 rounded-2xl border border-slate-100",children:[e.jsx("div",{className:"text-slate-400 mb-1",children:e.jsx(te,{size:16})}),e.jsx("div",{className:"text-[10px] text-slate-400 uppercase font-bold",children:"Size"}),e.jsx("div",{className:"font-semibold text-slate-700 text-sm",children:s.size})]}),e.jsxs("div",{className:"p-3 bg-slate-50 rounded-2xl border border-slate-100",children:[e.jsx("div",{className:"text-slate-400 mb-1",children:e.jsx(V,{size:16})}),e.jsx("div",{className:"text-[10px] text-slate-400 uppercase font-bold",children:"Date"}),e.jsx("div",{className:"font-semibold text-slate-700 text-sm",children:P(s.createTime)})]}),e.jsxs("div",{className:"p-3 bg-slate-50 rounded-2xl border border-slate-100",children:[e.jsx("div",{className:"text-slate-400 mb-1",children:e.jsx(W,{size:16})}),e.jsx("div",{className:"text-[10px] text-slate-400 uppercase font-bold",children:"Views"}),e.jsx("div",{className:"font-semibold text-slate-700 text-sm",children:s.viewCount})]})]})]})]})]})]})}export{ue as default};
