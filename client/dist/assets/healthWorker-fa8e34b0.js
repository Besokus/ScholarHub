(function(){"use strict";let t={apiBase:"",token:"",intervalMs:1e3},a=null,o=!1,f=0;const n=1e3,g=6e4;let r=!1;function M(...e){try{console.log("[HealthWorker]",...e)}catch{}}async function l(){if(t.apiBase&&!r)try{r=!0;const e={"Content-Type":"application/json"};t.token&&(e.Authorization=`Bearer ${t.token}`);const s=new AbortController,m=setTimeout(()=>s.abort(),15e3),p=await fetch(`${t.apiBase}/admin/health?_=${Date.now()}`,{headers:e,signal:s.signal});clearTimeout(m);const i=await p.json().catch(()=>null),c=i&&i.Data?i.Data:i;if(!p.ok){self.postMessage({type:"error",message:c&&(c.message||c.error)||`HTTP ${p.status}`}),r=!1;return}f=0,self.postMessage({type:"sample",data:c}),r=!1}catch(e){f++,self.postMessage({type:"error",message:(e==null?void 0:e.message)||String(e)||"Network error"});const s=Math.min(g,Math.max(n,(t.intervalMs||n)*Math.pow(2,Math.min(f,4))));u(s),r=!1}}function u(e){try{a&&clearInterval(a)}catch{}t.intervalMs=Math.max(1e3,e||n),self.postMessage({type:"status",status:"reconfigured",intervalMs:t.intervalMs}),a=setInterval(()=>{self.postMessage({type:"tick",now:Date.now()}),l()},t.intervalMs)}function h(){o||(o=!0,self.postMessage({type:"status",status:"starting",intervalMs:t.intervalMs}),a=setInterval(()=>{self.postMessage({type:"tick",now:Date.now()}),l()},Math.max(1e3,t.intervalMs||n)),l())}self.onmessage=e=>{const s=e.data;if(!(!s||typeof s!="object")){if(s.type==="config"){t.apiBase=s.apiBase,t.token=s.token,t.intervalMs=Math.max(1e3,s.intervalMs||n),M("configured",t),o?u(t.intervalMs):h();return}if(s.type==="check_now"){l();return}}},self.onerror=e=>{self.postMessage({type:"error",message:(e==null?void 0:e.message)||String(e)})},self.onclose=()=>{try{a&&clearInterval(a)}catch{}o=!1}})();
