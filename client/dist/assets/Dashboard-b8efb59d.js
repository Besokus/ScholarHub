import{c as k,r as m,q as se,j as e,L as qe,m as R,h as Fe,B as Je,M as Ke,s as W}from"./index-742c88f7.js";import{A as P,D as Ve}from"./database-46a36cab.js";import{T as ae}from"./triangle-alert-fc8f0f96.js";import{A as Xe}from"./index-7dbfdcd6.js";import{I as Ge}from"./info-dc6e5958.js";import{X as Qe}from"./x-551ee725.js";import{T as Ye}from"./trending-up-f6586554.js";/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ze=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],es=k("circle-check-big",Ze);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ss=[["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M17 20v2",key:"1rnc9c"}],["path",{d:"M17 2v2",key:"11trls"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M2 17h2",key:"7oei6x"}],["path",{d:"M2 7h2",key:"asdhe0"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"M20 17h2",key:"1fpfkl"}],["path",{d:"M20 7h2",key:"1o8tra"}],["path",{d:"M7 20v2",key:"4gnj0m"}],["path",{d:"M7 2v2",key:"1i4yhu"}],["rect",{x:"4",y:"4",width:"16",height:"16",rx:"2",key:"1vbyd7"}],["rect",{x:"8",y:"8",width:"8",height:"8",rx:"1",key:"z9xiuo"}]],ts=k("cpu",ss);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const as=[["path",{d:"M5 12h14",key:"1ays0h"}]],rs=k("minus",as);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ns=[["rect",{width:"20",height:"8",x:"2",y:"2",rx:"2",ry:"2",key:"ngkwjq"}],["rect",{width:"20",height:"8",x:"2",y:"14",rx:"2",ry:"2",key:"iecqi9"}],["line",{x1:"6",x2:"6.01",y1:"6",y2:"6",key:"16zg32"}],["line",{x1:"6",x2:"6.01",y1:"18",y2:"18",key:"nzw8ys"}]],ls=k("server",ns);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const is=[["line",{x1:"10",x2:"14",y1:"2",y2:"2",key:"14vaq8"}],["line",{x1:"12",x2:"15",y1:"14",y2:"11",key:"17fdiu"}],["circle",{cx:"12",cy:"14",r:"8",key:"1e1u0o"}]],cs=k("timer",is);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const os=[["path",{d:"M16 17h6v-6",key:"t6n2it"}],["path",{d:"m22 17-8.5-8.5-5 5L2 7",key:"x473p"}]],ds=k("trending-down",os);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xs=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],ms=k("users",xs),hs=({toasts:y,removeToast:v})=>e.jsx("div",{className:"fixed top-6 right-6 z-50 flex flex-col gap-3 pointer-events-none",children:e.jsx(Xe,{mode:"popLayout",children:y.map(c=>e.jsxs(R.div,{layout:!0,initial:{opacity:0,x:50,scale:.9},animate:{opacity:1,x:0,scale:1},exit:{opacity:0,x:20,scale:.95},transition:{type:"spring",stiffness:400,damping:30},className:"pointer-events-auto w-80 md:w-96 bg-white/90 backdrop-blur-md shadow-2xl border border-white/20 rounded-2xl overflow-hidden relative",children:[e.jsx("div",{className:`absolute left-0 top-0 bottom-0 w-1.5 ${c.type==="success"?"bg-emerald-500":c.type==="error"?"bg-rose-500":c.type==="warning"?"bg-amber-500":"bg-blue-500"}`}),e.jsxs("div",{className:"p-4 pl-5 flex items-start gap-3",children:[e.jsxs("div",{className:`mt-0.5 shrink-0 ${c.type==="success"?"text-emerald-500":c.type==="error"?"text-rose-500":c.type==="warning"?"text-amber-500":"text-blue-500"}`,children:[c.type==="success"&&e.jsx(es,{size:20}),c.type==="error"&&e.jsx(ae,{size:20}),c.type==="warning"&&e.jsx(ae,{size:20}),c.type==="info"&&e.jsx(Ge,{size:20})]}),e.jsxs("div",{className:"flex-1 mr-2",children:[e.jsx("h4",{className:`text-sm font-bold ${c.type==="success"?"text-emerald-900":c.type==="error"?"text-rose-900":c.type==="warning"?"text-amber-900":"text-slate-900"}`,children:c.title}),c.message&&e.jsx("p",{className:"text-xs text-slate-500 mt-1 leading-relaxed",children:c.message})]}),e.jsx("button",{onClick:()=>v(c.id),className:"text-slate-400 hover:text-slate-600 hover:bg-slate-100 p-1 rounded-lg transition-colors",children:e.jsx(Qe,{size:16})})]})]},c.id))})}),us={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1}}},bs={hidden:{y:20,opacity:0},visible:{y:0,opacity:1}},q=({title:y,value:v,icon:c,colorClass:_,trend:t,loading:I})=>e.jsxs(R.div,{variants:bs,whileHover:{y:-4,transition:{duration:.2}},className:"bg-white p-6 rounded-2xl shadow-sm border border-slate-100 relative overflow-hidden group",children:[e.jsx("div",{className:`absolute -right-4 -top-4 w-24 h-24 rounded-full opacity-5 group-hover:scale-110 transition-transform ${_.replace("text-","bg-")}`}),e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("div",{className:`p-3.5 rounded-xl ${_} bg-opacity-10`,children:e.jsx(c,{size:24})}),e.jsxs("div",{className:`flex items-center gap-1 text-xs font-bold px-2 py-1 rounded-full ${typeof t=="number"&&t>0?"bg-emerald-50 text-emerald-600":typeof t=="number"&&t<0?"bg-rose-50 text-rose-600":"bg-slate-100 text-slate-600"}`,children:[typeof t=="number"&&t>0?e.jsx(Ye,{size:12}):typeof t=="number"&&t<0?e.jsx(ds,{size:12}):e.jsx(rs,{size:12}),e.jsx("span",{children:`${Math.abs(Math.round((typeof t=="number"?t:0)*10)/10)}%`})]})]}),e.jsxs("div",{className:"space-y-1 relative z-10",children:[e.jsx("h3",{className:"text-slate-500 text-sm font-medium tracking-wide",children:y}),I?e.jsx("div",{className:"h-9 w-24 bg-slate-100 rounded-lg animate-pulse"}):e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("span",{className:"text-3xl font-extrabold text-slate-900",children:(v==null?void 0:v.toLocaleString())||0}),e.jsx("span",{className:"text-xs text-slate-400 font-normal",children:"total"})]})]})]}),te=({label:y,status:v,icon:c,load:_})=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-slate-50/50 rounded-xl border border-slate-100",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-white rounded-lg shadow-sm text-slate-500",children:e.jsx(c,{size:18})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-bold text-slate-700",children:y}),e.jsxs("div",{className:"flex items-center gap-1.5 mt-0.5",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${v==="Healthy"?"bg-emerald-500 animate-pulse":"bg-amber-500"}`}),e.jsx("span",{className:"text-xs text-slate-500",children:v})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-sm font-bold text-slate-800",children:[_,"%"]}),e.jsx("div",{className:"text-xs text-slate-400",children:"Load"})]})]}),ws=()=>{var me,he,ue,be,pe,fe,ge,je,ve,Ne,ye,we,Me,ke,_e,Se,Re,Ce,$e,De,Pe,Ie;const[y,v]=m.useState({}),[c,_]=m.useState(!0),[t,I]=m.useState(null),[re,He]=m.useState([]),[j,ze]=m.useState(null),[Te,ne]=m.useState([]),S=m.useRef(0),C=(s,a,d)=>{const h=Date.now().toString();ne(x=>[...x,{id:h,type:s,title:a,message:d}]),setTimeout(()=>le(h),5e3)},le=s=>{ne(a=>a.filter(d=>d.id!==s))},f={VITE_API_URL:"http://localhost:3001/api",BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},F=Number(localStorage.getItem("health_refresh_ms")||""),J=Number((f==null?void 0:f.VITE_HEALTH_REFRESH_MS)||""),K=Number(localStorage.getItem("stats_refresh_ms")||""),V=Number((f==null?void 0:f.VITE_STATS_REFRESH_MS)||""),H=Number.isFinite(F)&&F>0?F:Number.isFinite(J)&&J>0?J:f!=null&&f.PROD?5*60*1e3:30*1e3,z=Number.isFinite(K)&&K>0?K:Number.isFinite(V)&&V>0?V:f!=null&&f.PROD?5*60*1e3:30*1e3,[Ae,ie]=m.useState(!1),[Le,ce]=m.useState(!1),X=Ae||Le,[T,A]=m.useState(!1),G=m.useRef(new Map),Q=m.useRef(!1),oe=m.useRef(!1),w=m.useRef({statsCur:[],statsPrev:[],health:[]}),L=m.useRef({hits:0,misses:0}),[E,Ee]=m.useState({students:0,teachers:0,resources:0,questions:0}),[l,$]=m.useState({statsCur:{count:0,avgMs:0},statsPrev:{count:0,avgMs:0},health:{count:0,avgMs:0},interval:{stats:z,health:H},cache:{size:0,hits:0,misses:0,hitRate:0},lastUpdated:Date.now()}),Ue=m.useRef({buf:new Array(60).fill(0),cap:60,idx:0,len:0}),Y=m.useMemo(()=>({api:s=>s>=80?"Healthy":s>=60?"Warning":"Critical",db:s=>s<=200?"Healthy":s<=1e3?"Warning":"Critical",storage:s=>s<=80?"Healthy":s<=95?"Warning":"Critical"}),[]),U=(s,a)=>!Number.isFinite(a)||a===0?s>0?100:0:(s-a)/a*100,Oe=s=>{var o,b,r,g,i,M;if(typeof document<"u"&&document.hidden)return 3e3;const h=Number(((b=(o=s==null?void 0:s.components)==null?void 0:o.cpu)==null?void 0:b.usedPercent)||0),x=Number(((g=(r=s==null?void 0:s.components)==null?void 0:r.memory)==null?void 0:g.usedPercent)||0),p=Number(((M=(i=s==null?void 0:s.components)==null?void 0:i.db)==null?void 0:M.latencyMs)||0),n=Number((s==null?void 0:s.score)||0);return h>=85||x>=85||p>=1e3||n<60?3e3:h>=75||x>=75||p>=500||n<80?2e3:1e3},de=(s,a)=>{const d=G.current.get(s);return d&&Date.now()-d.t<=a?(L.current.hits+=1,d.d):(L.current.misses+=1,null)},xe=(s,a)=>G.current.set(s,{t:Date.now(),d:a}),Z=(s,a)=>{const d=w.current[s];d.push(a),d.length>120&&d.shift();const h=w.current.statsCur.reduce((g,i)=>g+i,0)/Math.max(1,w.current.statsCur.length),x=w.current.statsPrev.reduce((g,i)=>g+i,0)/Math.max(1,w.current.statsPrev.length),p=w.current.health.reduce((g,i)=>g+i,0)/Math.max(1,w.current.health.length),n=L.current.hits,o=L.current.misses,b=Math.max(1,n+o),r=Math.round(n/b*100);$({statsCur:{count:w.current.statsCur.length,avgMs:Math.round(h)},statsPrev:{count:w.current.statsPrev.length,avgMs:Math.round(x)},health:{count:w.current.health.length,avgMs:Math.round(p)},interval:{stats:z,health:H},cache:{size:G.current.size,hits:n,misses:o,hitRate:r},lastUpdated:Date.now()})};return m.useEffect(()=>{(async()=>{try{const a=await W.stats();v(a.data)}catch{}_(!1)})()},[]),m.useEffect(()=>{let s;const a=async()=>{if(Q.current)return;Q.current=!0,ie(!0),A(!1);const h=Date.now()-24*60*60*1e3;try{const x="stats:cur",p="stats:prev";let n=de(x,2e3),o=de(p,9e5);if(!n){const b=performance.now(),r=await W.stats(),g=performance.now();Z("statsCur",g-b),n=r.data,xe(x,n)}if(!o){const b=performance.now(),r=await W.stats({ts:h}),g=performance.now();Z("statsPrev",g-b),o=r.data,xe(p,o)}v(n),Ee({students:U(Number((n==null?void 0:n.students)||0),Number((o==null?void 0:o.students)||0)),teachers:U(Number((n==null?void 0:n.teachers)||0),Number((o==null?void 0:o.teachers)||0)),resources:U(Number((n==null?void 0:n.resources)||0),Number((o==null?void 0:o.resources)||0)),questions:U(Number((n==null?void 0:n.questions)||0),Number((o==null?void 0:o.questions)||0))})}catch{A(!0)}finally{Q.current=!1,ie(!1)}};return a(),s=setInterval(a,z),()=>{s&&clearInterval(s)}},[z]),m.useEffect(()=>{const s=localStorage.getItem("token")||"",a=Number(localStorage.getItem("health_refresh_ms")||""),d=Number({VITE_API_URL:"http://localhost:3001/api",BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1}.VITE_HEALTH_REFRESH_MS||""),h=Number.isFinite(a)&&a>0?a:Number.isFinite(d)&&d>0?d:3e4;let x=null,p=0;const n=b=>{var g;const r=b.data;if(!(!r||typeof r!="object")){if(r.type==="status"){console.log("[HealthWorker status]",r),$(i=>({...i,interval:{...i.interval,health:r.intervalMs},lastUpdated:Date.now()}));return}if(r.type==="tick"){$(i=>({...i,lastUpdated:r.now}));return}if(r.type==="error"){A(!0),console.error("[HealthWorker error]",r.message),Date.now()-S.current>60*1e3&&(C("error","健康检查后台服务异常",String(r.message||"未知错误")),S.current=Date.now());return}if(r.type==="sample"){const i=r.data;I(i);try{localStorage.setItem("health:last",JSON.stringify({d:i,ts:Date.now()}))}catch{}{const N=Number((i==null?void 0:i.score)||0),u=Ue.current;u.buf[u.idx]=N,u.idx=(u.idx+1)%u.cap,u.len=Math.min(u.cap,u.len+1);const B=u.len<u.cap?u.buf.slice(0,u.len):[...u.buf.slice(u.idx),...u.buf.slice(0,u.idx)];He(B)}try{const N=localStorage.getItem("health:hist24"),u=N?JSON.parse(N):[],B=Date.now();u.push({ts:B,score:Number((i==null?void 0:i.score)||0)});const Be=B-24*60*60*1e3,We=u.filter(ee=>Number((ee==null?void 0:ee.ts)||0)>=Be);localStorage.setItem("health:hist24",JSON.stringify(We))}catch{}Z("health",Number((i==null?void 0:i.endpointMs)||0));const M=Date.now();$(p?N=>({...N,interval:{...N.interval,health:M-p},lastUpdated:M}):N=>({...N,lastUpdated:M})),p=M;try{const N=Oe(i);(g=window.__healthWorker__)==null||g.postMessage({type:"config",apiBase:se,token:s,intervalMs:N})}catch{}const D=Number((i==null?void 0:i.score)||0),O=Date.now();D<60&&O-S.current>60*1e3?(C("error","系统健康度严重预警",`当前健康评分仅为 ${D}，请立即检查服务器负载。`),S.current=O):D>=60&&D<80&&O-S.current>120*1e3&&(C("warning","系统负载较高",`健康评分为 ${D}，请关注资源使用情况。`),S.current=O)}}};try{const b=localStorage.getItem("health:last");if(b){const r=JSON.parse(b);r&&r.d&&I(r.d)}}catch{}oe.current=!0,ce(!0),A(!1),x=new Worker(new URL("/assets/healthWorker-fa8e34b0.js",self.location),{type:"module"}),window.__healthWorker__=x,x.addEventListener("message",n),x.postMessage({type:"config",apiBase:se,token:s,intervalMs:h}),ce(!1),oe.current=!1;const o=()=>{var r;const b=document.hidden?3e3:1e3;try{(r=window.__healthWorker__)==null||r.postMessage({type:"config",apiBase:se,token:s,intervalMs:b})}catch{}};return document.addEventListener("visibilitychange",o),()=>{x&&(x.removeEventListener("message",n),x.terminate());try{delete window.__healthWorker__}catch{}document.removeEventListener("visibilitychange",o)}},[]),m.useEffect(()=>{let s;const a=async()=>{try{const d=await W.serviceStatus(),h=d&&d.data?d.data:d;ze(h);try{const x=Number((h==null?void 0:h.completeness24h)||0),p=h!=null&&h.lastHeartbeat?new Date(h.lastHeartbeat).getTime():0;x<99&&C("warning","采集完整度不足",`最近24小时采样完整度 ${x}%`),p&&Date.now()-p>5e3&&C("error","后台服务可能中断","采集心跳超过 5 秒未更新")}catch{}}catch{}};return a(),s=setInterval(a,H),()=>{s&&clearInterval(s)}},[H]),e.jsxs("div",{className:"p-6 md:p-8 max-w-7xl mx-auto relative",children:[e.jsx(hs,{toasts:Te,removeToast:le}),e.jsxs("div",{className:"mb-8 relative",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-end justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-[10px] font-bold bg-indigo-50 text-indigo-600 border border-indigo-100 uppercase tracking-wider",children:"System Monitor"}),f!=null&&f.PROD?e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-[10px] font-bold bg-emerald-50 text-emerald-600 border border-emerald-100 uppercase tracking-wider",children:"Production"}):e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-[10px] font-bold bg-slate-100 text-slate-500 border border-slate-200 uppercase tracking-wider",children:"Dev"}),e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-0.5 rounded text-[10px] font-bold border uppercase tracking-wider ${j!=null&&j.running?"bg-emerald-50 text-emerald-600 border-emerald-100":"bg-rose-50 text-rose-600 border-rose-100"}`,children:[e.jsx("span",{className:`w-1.5 h-1.5 rounded-full ${j!=null&&j.running?"bg-emerald-500":"bg-rose-500"}`}),j!=null&&j.running?"Service OK":"Service Down"]})]}),e.jsxs("h1",{className:"text-3xl md:text-4xl font-extrabold text-slate-900 tracking-tight flex items-center gap-3",children:["仪表盘",e.jsxs("span",{className:"relative flex h-3 w-3",children:[e.jsx("span",{className:`animate-ping absolute inline-flex h-full w-full rounded-full opacity-75 ${T?"bg-amber-400":"bg-emerald-400"}`}),e.jsx("span",{className:`relative inline-flex rounded-full h-3 w-3 ${T?"bg-amber-500":"bg-emerald-500"}`})]})]}),e.jsxs("p",{className:"text-slate-500 mt-2 text-sm flex items-center gap-2",children:[e.jsx(P,{size:16,className:"text-indigo-500"}),e.jsx("span",{children:"实时监控系统各项指标与健康状态"})]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-2",children:[e.jsx("div",{className:`flex items-center gap-2 px-3 py-1.5 rounded-full border text-xs font-medium transition-colors ${X?"bg-indigo-50 border-indigo-100 text-indigo-700":T?"bg-amber-50 border-amber-100 text-amber-700":"bg-white border-slate-200 text-slate-600 shadow-sm"}`,children:X?e.jsxs(e.Fragment,{children:[e.jsx(qe,{className:"h-3.5 w-3.5 animate-spin"}),e.jsx("span",{children:"正在刷新数据..."})]}):T?e.jsxs(e.Fragment,{children:[e.jsx(ae,{className:"h-3.5 w-3.5"}),e.jsx("span",{children:"部分数据获取异常"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-emerald-500"}),e.jsx("span",{children:"系统运行正常"})]})}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-[10px] uppercase tracking-wider text-slate-400 font-semibold mb-0.5",children:"Last Updated"}),e.jsx("div",{className:"text-xl font-mono font-bold text-slate-700 tabular-nums",children:new Date(l.lastUpdated).toLocaleTimeString([],{hour12:!1})}),e.jsxs("div",{className:"text-[10px] text-slate-400 mt-0.5",children:["Completeness 24h: ",e.jsxs("span",{className:"font-mono text-slate-700",children:[typeof(j==null?void 0:j.completeness24h)=="number"?j.completeness24h:"—","%"]})]})]})]})]}),X&&e.jsx(R.div,{className:"absolute -bottom-4 left-0 h-0.5 bg-indigo-500",initial:{width:0,opacity:1},animate:{width:"100%",opacity:0},transition:{duration:1.5,ease:"easeInOut",repeat:1/0}})]}),e.jsxs(R.div,{variants:us,initial:"hidden",animate:"visible",className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsx(q,{title:"学生总数",value:y.students,icon:ms,colorClass:"text-blue-600 bg-blue-50",trend:E.students,loading:c}),e.jsx(q,{title:"教师总数",value:y.teachers,icon:Fe,colorClass:"text-purple-600 bg-purple-50",trend:E.teachers,loading:c}),e.jsx(q,{title:"资源沉淀",value:y.resources,icon:Je,colorClass:"text-emerald-600 bg-emerald-50",trend:E.resources,loading:c}),e.jsx(q,{title:"社区互动",value:y.questions,icon:Ke,colorClass:"text-amber-600 bg-amber-50",trend:E.questions,loading:c})]}),e.jsxs(R.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},className:"bg-white rounded-2xl shadow-sm border border-slate-200 p-6 md:p-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-lg font-bold text-slate-800 flex items-center gap-2",children:[e.jsx(P,{size:20,className:"text-indigo-500"})," 系统健康度"]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`px-3 py-1 rounded-full text-xs font-bold ${(t==null?void 0:t.status)==="Healthy"?"bg-emerald-50 text-emerald-600":(t==null?void 0:t.status)==="Warning"?"bg-amber-50 text-amber-600":"bg-rose-50 text-rose-600"}`,children:(t==null?void 0:t.status)||"—"}),e.jsxs("div",{className:"text-sm text-slate-600",children:["分值 ",typeof(t==null?void 0:t.score)=="number"?t.score:"—"]}),e.jsx("button",{className:"px-3 py-1.5 rounded-lg border border-slate-200 text-xs font-bold text-slate-600 hover:bg-slate-50 active:scale-[0.98]",onClick:()=>{var s;try{(s=window.__healthWorker__)==null||s.postMessage({type:"check_now"})}catch{}},children:"立即检查"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx(te,{label:"API Server",status:Y.api(Number((t==null?void 0:t.score)||0)),icon:ls,load:Math.round(Number(((he=(me=t==null?void 0:t.components)==null?void 0:me.cpu)==null?void 0:he.usedPercent)||0))}),e.jsx(te,{label:"Database",status:Y.db(Number(((be=(ue=t==null?void 0:t.components)==null?void 0:ue.db)==null?void 0:be.latencyMs)||0)),icon:Ve,load:Math.round(Number(((fe=(pe=t==null?void 0:t.components)==null?void 0:pe.db)==null?void 0:fe.latencyMs)||0))}),e.jsx(te,{label:"Storage",status:Y.storage(Number(((je=(ge=t==null?void 0:t.components)==null?void 0:ge.disk)==null?void 0:je.usedPercent)||0)),icon:ts,load:Math.round(Number(((Ne=(ve=t==null?void 0:t.components)==null?void 0:ve.disk)==null?void 0:Ne.usedPercent)||0))})]}),e.jsxs("div",{className:"mt-6 bg-slate-50 rounded-xl border border-slate-200 p-4",children:[e.jsx("div",{className:"text-sm font-bold text-slate-700 mb-3",children:"评分明细"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:["cpu","memory","disk","db","net","svc"].map(s=>{var o,b,r;const a=((o=t==null?void 0:t.breakdown)==null?void 0:o[s])||null;if(!a)return e.jsx("div",{className:"p-3 bg-white rounded-lg border border-slate-100 text-xs text-slate-400",children:"无数据"},s);const d=s==="cpu"?"CPU":s==="memory"?"内存":s==="disk"?"磁盘":s==="db"?"数据库":s==="net"?"网络":"服务响应",h=typeof a.value=="number"?Math.round(a.value)+(s==="db"||s==="net"||s==="svc"?" ms":"%"):typeof a.latencyMs=="number"?Math.round(a.latencyMs)+" ms":"—",x=typeof a.severity=="number"?Math.round(a.severity):0,p=typeof a.weight=="number"?Math.round(a.weight*100)/100:0,n=typeof a.penalty=="number"?Math.round(a.penalty*100)/100:0;return e.jsxs("div",{className:"p-3 bg-white rounded-lg border border-slate-100",children:[e.jsx("div",{className:"text-xs font-bold text-slate-700 mb-1",children:d}),e.jsxs("div",{className:"text-xs text-slate-600",children:["值 ",h]}),e.jsxs("div",{className:"mt-1 flex items-center justify-between text-[12px]",children:[e.jsx("span",{className:"text-slate-500",children:"严重度"}),e.jsx("span",{className:`font-bold ${x>=80?"text-rose-600":x>=60?"text-amber-600":"text-slate-700"}`,children:x})]}),e.jsxs("div",{className:"mt-1 flex items-center justify-between text-[12px]",children:[e.jsx("span",{className:"text-slate-500",children:"权重"}),e.jsx("span",{className:"font-bold text-slate-700",children:p})]}),e.jsxs("div",{className:"mt-1 flex items-center justify-between text-[12px]",children:[e.jsx("span",{className:"text-slate-500",children:"扣分"}),e.jsx("span",{className:`font-bold ${n>=20?"text-rose-600":n>=10?"text-amber-600":"text-emerald-600"}`,children:n})]}),s==="disk"&&(a==null?void 0:a.type)&&e.jsxs("div",{className:"mt-1 text-[11px] text-slate-400",children:["类型 ",a.type," · 正常 ",(b=a.thresholds)==null?void 0:b.normal_low,"–",(r=a.thresholds)==null?void 0:r.normal_high,"%"]})]},s)})})]}),e.jsxs("div",{className:"mt-8",children:[e.jsxs("div",{className:"text-sm text-slate-600 mb-2",children:["健康度趋势（最近 ",re.length," 次）"]}),e.jsx("div",{className:"flex items-end gap-1 h-24",children:re.map((s,a)=>e.jsx(R.div,{className:`flex-1 rounded-t ${s>=80?"bg-emerald-400":s>=60?"bg-amber-400":"bg-rose-400"}`,animate:{height:`${Math.max(4,Math.min(100,s))}%`},transition:{duration:.25}},a))})]}),e.jsxs("div",{className:"mt-8 grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-6",children:[e.jsxs("div",{className:"p-4 bg-slate-50 rounded-xl border border-slate-200",children:[e.jsx("div",{className:"text-sm font-bold text-slate-700 mb-3",children:"指标详情"}),e.jsxs("div",{className:"text-sm text-slate-600 space-y-2",children:[e.jsxs("div",{children:["CPU 使用率：",Math.round(Number(((we=(ye=t==null?void 0:t.components)==null?void 0:ye.cpu)==null?void 0:we.usedPercent)||0)),"%"]}),e.jsxs("div",{children:["内存占用：",Math.round(Number(((ke=(Me=t==null?void 0:t.components)==null?void 0:Me.memory)==null?void 0:ke.usedPercent)||0)),"%"]}),e.jsxs("div",{children:["磁盘使用率：",Math.round(Number(((Se=(_e=t==null?void 0:t.components)==null?void 0:_e.disk)==null?void 0:Se.usedPercent)||0)),"%"]}),e.jsxs("div",{children:["数据库延迟：",Math.round(Number(((Ce=(Re=t==null?void 0:t.components)==null?void 0:Re.db)==null?void 0:Ce.latencyMs)||0))," ms"]}),e.jsxs("div",{children:["网络吞吐：↑ ",Math.round(Number(((De=($e=t==null?void 0:t.components)==null?void 0:$e.network)==null?void 0:De.outBps)||0))," B/s · ↓ ",Math.round(Number(((Ie=(Pe=t==null?void 0:t.components)==null?void 0:Pe.network)==null?void 0:Ie.inBps)||0))," B/s"]})]})]}),e.jsxs("div",{className:"p-4 bg-slate-50 rounded-xl border border-slate-200",children:[e.jsx("div",{className:"text-sm font-bold text-slate-700 mb-3",children:"告警阈值"}),e.jsxs("div",{className:"text-sm text-slate-600 space-y-2",children:[e.jsx("div",{children:"CPU 警告 ≥ 75%，严重 ≥ 90%"}),e.jsx("div",{children:"内存 警告 ≥ 75%，严重 ≥ 90%"}),e.jsx("div",{children:"磁盘 警告 ≥ 80%，严重 ≥ 95%"}),e.jsx("div",{children:"数据库延迟 警告 ≥ 200ms"}),e.jsx("div",{children:"综合分值 警告 ＜ 80，严重 ＜ 60"})]})]})]}),e.jsxs("div",{className:"p-5 bg-slate-50 rounded-xl border border-slate-200 h-full",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"text-sm font-bold text-slate-800 flex items-center gap-2",children:[e.jsx(cs,{size:18,className:"text-indigo-600"}),"性能监控 & 采样统计"]}),e.jsxs("span",{className:"text-[10px] bg-white border border-slate-200 px-2 py-0.5 rounded text-slate-400",children:["Last: ",new Date(l.lastUpdated).toLocaleTimeString()]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-white p-3 rounded-lg border border-slate-100 shadow-sm flex flex-col justify-between",children:[e.jsx("div",{className:"text-xs text-slate-400 mb-1",children:"统计刷新间隔"}),e.jsxs("div",{className:"flex items-end justify-between",children:[e.jsxs("span",{className:"text-xl font-bold text-slate-700",children:[Math.round(l.interval.stats/1e3),e.jsx("span",{className:"text-xs font-normal text-slate-400 ml-0.5",children:"s"})]}),e.jsx(P,{size:16,className:"text-emerald-500 mb-1 animate-pulse",style:{animationDuration:`${l.interval.stats}ms`}})]})]}),e.jsxs("div",{className:"bg-white p-3 rounded-lg border border-slate-100 shadow-sm flex flex-col justify-between",children:[e.jsx("div",{className:"text-xs text-slate-400 mb-1",children:"健康检查间隔"}),e.jsxs("div",{className:"flex items-end justify-between",children:[e.jsxs("span",{className:"text-xl font-bold text-slate-700",children:[Math.round(l.interval.health/1e3),e.jsx("span",{className:"text-xs font-normal text-slate-400 ml-0.5",children:"s"})]}),e.jsx(P,{size:16,className:"text-blue-500 mb-1 animate-pulse",style:{animationDuration:`${l.interval.health}ms`}})]})]}),e.jsxs("div",{className:"bg-white p-3 rounded-lg border border-slate-100 shadow-sm flex flex-col justify-between",children:[e.jsxs("div",{className:"text-xs text-slate-400 mb-1 flex justify-between",children:[e.jsx("span",{children:"统计接口耗时"}),e.jsx("span",{className:"text-[10px] bg-slate-100 px-1 rounded",children:"Avg"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-baseline gap-1",children:[e.jsx("span",{className:`text-xl font-bold ${l.statsCur.avgMs>500?"text-rose-500":l.statsCur.avgMs>200?"text-amber-500":"text-slate-700"}`,children:l.statsCur.avgMs}),e.jsx("span",{className:"text-xs text-slate-400",children:"ms"})]}),e.jsx("div",{className:"w-full h-1.5 bg-slate-100 rounded-full mt-2 overflow-hidden",children:e.jsx("div",{className:`h-full rounded-full ${l.statsCur.avgMs>500?"bg-rose-500":l.statsCur.avgMs>200?"bg-amber-500":"bg-emerald-500"}`,style:{width:`${Math.min(100,l.statsCur.avgMs/1e3*100)}%`}})})]})]}),e.jsxs("div",{className:"bg-white p-3 rounded-lg border border-slate-100 shadow-sm flex flex-col justify-between",children:[e.jsxs("div",{className:"text-xs text-slate-400 mb-1 flex justify-between",children:[e.jsx("span",{children:"健康检查耗时"}),e.jsx("span",{className:"text-[10px] bg-slate-100 px-1 rounded",children:"Avg"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-baseline gap-1",children:[e.jsx("span",{className:`text-xl font-bold ${l.health.avgMs>500?"text-rose-500":l.health.avgMs>200?"text-amber-500":"text-slate-700"}`,children:l.health.avgMs}),e.jsx("span",{className:"text-xs text-slate-400",children:"ms"})]}),e.jsx("div",{className:"w-full h-1.5 bg-slate-100 rounded-full mt-2 overflow-hidden",children:e.jsx("div",{className:`h-full rounded-full ${l.health.avgMs>500?"bg-rose-500":l.health.avgMs>200?"bg-amber-500":"bg-blue-500"}`,style:{width:`${Math.min(100,l.health.avgMs/1e3*100)}%`}})})]})]}),e.jsxs("div",{className:"bg-white p-3 rounded-lg border border-slate-100 shadow-sm flex flex-col justify-between",children:[e.jsx("div",{className:"text-xs text-slate-400 mb-1",children:"缓存条目"}),e.jsxs("div",{className:"flex items-end justify-between",children:[e.jsx("span",{className:"text-xl font-bold text-slate-700",children:l.cache.size}),e.jsx(P,{size:16,className:"text-slate-500 mb-1"})]})]}),e.jsxs("div",{className:"bg-white p-3 rounded-lg border border-slate-100 shadow-sm flex flex-col justify-between",children:[e.jsxs("div",{className:"text-xs text-slate-400 mb-1 flex justify-between",children:[e.jsx("span",{children:"缓存命中率"}),e.jsx("span",{className:"text-[10px] bg-slate-100 px-1 rounded",children:"%"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-baseline gap-1",children:[e.jsx("span",{className:`text-xl font-bold ${l.cache.hitRate<50?"text-rose-500":l.cache.hitRate<80?"text-amber-500":"text-slate-700"}`,children:l.cache.hitRate}),e.jsx("span",{className:"text-xs text-slate-400",children:"%"})]}),e.jsx("div",{className:"w-full h-1.5 bg-slate-100 rounded-full mt-2 overflow-hidden",children:e.jsx("div",{className:`h-full rounded-full ${l.cache.hitRate<50?"bg-rose-500":l.cache.hitRate<80?"bg-amber-500":"bg-emerald-500"}`,style:{width:`${Math.min(100,l.cache.hitRate)}%`}})})]})]})]}),e.jsxs("div",{className:"mt-4 pt-3 border-t border-slate-200 flex justify-between gap-4 text-xs text-slate-500",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-slate-400"}),"统计采样: ",e.jsx("span",{className:"font-mono font-bold text-slate-700",children:l.statsCur.count})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-slate-400"}),"健康采样: ",e.jsx("span",{className:"font-mono font-bold text-slate-700",children:l.health.count})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-slate-400"}),"缓存命中: ",e.jsx("span",{className:"font-mono font-bold text-slate-700",children:l.cache.hits})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-slate-400"}),"缓存未命中: ",e.jsx("span",{className:"font-mono font-bold text-slate-700",children:l.cache.misses})]})]})]})]})]})]})};export{ws as default};
