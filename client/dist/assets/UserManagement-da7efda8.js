import{c as N,r as l,q as c,j as e,L as I,m as y}from"./index-5b5873b3.js";import{S as P}from"./search-0fdf07c0.js";import{A as z}from"./index-1fea0efe.js";import{M as B}from"./mail-6167b5f6.js";import{T as H}from"./trash-2-9853bb5e.js";import{C as Q}from"./chevron-up-5dfcb618.js";import{C as R}from"./chevron-down-9d9beabd.js";import{X as V}from"./x-07aa51c2.js";import{S as X}from"./save-edb4bba4.js";/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]],E=N("briefcase",G);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],K=N("pen",J);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],Y=N("user-plus",W),de=()=>{const[r,M]=l.useState([]),[v,w]=l.useState(!0),[m,T]=l.useState(""),[q,o]=l.useState(!1),[i,k]=l.useState(null),[d,A]=l.useState(!1),p=10,[t,n]=l.useState({password:"",fullName:"",employeeId:"",title:"讲师"}),[h,u]=l.useState(!1),[S,f]=l.useState(""),g=t.employeeId?`${t.employeeId}@edu`:"",D=s=>{const a=(s||"").trim();return/^\d+$/.test(a)?a:a||"-"};l.useEffect(()=>{b()},[m]);const b=async()=>{var s;w(!0);try{const a=await c.teachers.list({q:m});M(((s=a.data)==null?void 0:s.items)||[])}catch(a){console.error(a)}finally{w(!1)}},_=async s=>{var C;if(s.preventDefault(),!/^\d{6}$/.test(t.employeeId.trim())){f("工号必须为6位数字");return}u(!0);try{if(i)await c.teachers.update(i.id,t);else{try{if((((C=(await c.teachers.list({q:g})).data)==null?void 0:C.items)||[]).some(j=>String((j==null?void 0:j.username)||"")===g)){alert("自动生成的登录账号已存在，请更换工号"),u(!1);return}}catch{}await c.teachers.create(t)}o(!1),b()}catch(x){alert(String((x==null?void 0:x.message)||"操作失败"))}finally{u(!1)}},$=async s=>{if(confirm("确定要删除该教师账号吗？此操作不可恢复。"))try{await c.teachers.remove(s),b()}catch{alert("删除失败")}},L=s=>{k(s),n({password:"",fullName:s.fullName||"",employeeId:s.employeeId||"",title:s.title||"讲师"}),o(!0)},O=()=>{k(null),n({password:"",fullName:"",employeeId:"",title:"讲师"}),f(""),o(!0)},F=d?r:r.slice(0,p),U=r.length>p;return e.jsxs("div",{className:"p-6 md:p-8 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 mb-8",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-slate-800 flex items-center gap-2",children:[e.jsx(E,{className:"text-indigo-600",size:24})," 教师管理"]}),e.jsx("p",{className:"text-slate-500 mt-1 text-sm",children:"管理教师账号、职称及系统权限配置"})]}),e.jsxs("button",{onClick:O,className:"flex items-center gap-2 px-5 py-2.5 bg-indigo-600 text-white rounded-xl font-medium hover:bg-indigo-700 active:scale-95 transition-all shadow-lg shadow-indigo-200",children:[e.jsx(Y,{size:18})," 新增教师"]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"p-4 border-b border-slate-100 bg-slate-50/50 flex flex-col sm:flex-row gap-4 justify-between items-center shrink-0",children:[e.jsxs("div",{className:"relative w-full sm:w-80",children:[e.jsx(P,{className:"absolute left-3.5 top-2.5 text-slate-400",size:18}),e.jsx("input",{type:"text",placeholder:"搜索姓名、工号...",className:"w-full pl-10 pr-4 py-2 bg-white border border-slate-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 transition-all shadow-sm",value:m,onChange:s=>T(s.target.value)})]}),e.jsxs("div",{className:"text-xs text-slate-400 font-medium",children:["共找到 ",r.length," 位教师"]})]}),e.jsx("div",{className:`overflow-x-auto transition-all duration-500 ease-in-out ${d?"max-h-[600px] overflow-y-auto border-b border-slate-100":"overflow-hidden"}`,children:e.jsxs("table",{className:"w-full text-left text-sm relative",children:[e.jsx("thead",{className:"bg-slate-50 text-slate-500 font-medium border-b border-slate-200 sticky top-0 z-10 shadow-sm",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 bg-slate-50",children:"基本信息"}),e.jsx("th",{className:"px-6 py-4 bg-slate-50",children:"工号 / 职称"}),e.jsx("th",{className:"px-6 py-4 bg-slate-50",children:"账号"}),e.jsx("th",{className:"px-6 py-4 bg-slate-50",children:"联系方式"}),e.jsx("th",{className:"px-6 py-4 text-right bg-slate-50",children:"操作"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100",children:v?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"p-12 text-center",children:e.jsx(I,{className:"animate-spin mx-auto text-indigo-600"})})}):r.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"p-12 text-center text-slate-400",children:"暂无数据"})}):e.jsx(z,{initial:!1,children:F.map(s=>e.jsxs(y.tr,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"hover:bg-slate-50/80 transition-colors group",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-9 h-9 rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 text-white flex items-center justify-center font-bold text-sm shadow-sm shrink-0",children:(s.fullName||s.username)[0].toUpperCase()}),e.jsx("div",{className:"font-bold text-slate-700",children:s.fullName||"未命名"})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-mono text-slate-600",title:"显示的是教师ID",children:D(s.id)}),e.jsx("span",{className:"text-xs text-slate-400 bg-slate-100 px-1.5 py-0.5 rounded w-fit mt-1",children:s.title})]})}),e.jsx("td",{className:"px-6 py-4 text-slate-600 font-medium",children:s.username}),e.jsx("td",{className:"px-6 py-4 text-slate-500 flex items-center gap-2",children:s.email?e.jsxs(e.Fragment,{children:[e.jsx(B,{size:14,className:"text-slate-400"})," ",s.email]}):e.jsx("span",{className:"text-slate-300 italic",children:"未绑定"})}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsxs("div",{className:"flex justify-end gap-2 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:()=>L(s),className:"p-1.5 text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors",title:"编辑",children:e.jsx(K,{size:16})}),e.jsx("button",{onClick:()=>$(s.id),className:"p-1.5 text-rose-500 hover:bg-rose-50 rounded-lg transition-colors",title:"删除",children:e.jsx(H,{size:16})})]})})]},s.id))})})]})}),!v&&U&&e.jsx("div",{className:"p-4 bg-slate-50 border-t border-slate-200 text-center",children:e.jsx("button",{onClick:()=>A(!d),className:"text-sm font-bold text-indigo-600 hover:text-indigo-700 hover:bg-indigo-50 px-6 py-2 rounded-full transition-all inline-flex items-center gap-2 group",children:d?e.jsxs(e.Fragment,{children:["收起列表 ",e.jsx(Q,{size:16,className:"group-hover:-translate-y-0.5 transition-transform"})]}):e.jsxs(e.Fragment,{children:["查看全部 (",r.length-p," 位更多) ",e.jsx(R,{size:16,className:"group-hover:translate-y-0.5 transition-transform"})]})})})]}),e.jsx(z,{children:q&&e.jsx(y.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm p-4",children:e.jsxs(y.div,{initial:{scale:.95,opacity:0,y:10},animate:{scale:1,opacity:1,y:0},exit:{scale:.95,opacity:0,y:10},className:"bg-white rounded-2xl shadow-2xl w-full max-w-lg overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-slate-100 flex items-center justify-between bg-slate-50",children:[e.jsx("h3",{className:"font-bold text-lg text-slate-800",children:i?"编辑教师信息":"添加新教师"}),e.jsx("button",{onClick:()=>o(!1),className:"text-slate-400 hover:text-slate-600 hover:bg-slate-200 rounded-full p-1 transition",children:e.jsx(V,{size:20})})]}),e.jsxs("form",{onSubmit:_,className:"p-6 space-y-5",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-5",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("label",{className:"text-xs font-bold text-slate-500 uppercase",children:["姓名 ",e.jsx("span",{className:"text-rose-500",children:"*"})]}),e.jsx("input",{required:!0,className:"w-full px-3 py-2.5 bg-slate-50 border border-slate-200 rounded-xl focus:bg-white focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 outline-none transition-all text-sm",value:t.fullName,onChange:s=>n({...t,fullName:s.target.value}),placeholder:"e.g. 王老师"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("label",{className:"text-xs font-bold text-slate-500 uppercase",children:["工号 ",e.jsx("span",{className:"text-rose-500",children:"*"})]}),e.jsx("input",{required:!0,className:"w-full px-3 py-2.5 bg-slate-50 border border-slate-200 rounded-xl focus:bg-white focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 outline-none transition-all text-sm font-mono",value:t.employeeId,onChange:s=>{const a=s.target.value.replace(/\D/g,"").slice(0,6);n({...t,employeeId:a}),f(/^\d{6}$/.test(a)?"":"工号必须为6位数字")},placeholder:"e.g. 123456"}),t.employeeId&&e.jsxs("div",{className:"text-xs text-slate-500",children:["登录账号将自动生成：",e.jsx("span",{className:"font-mono text-slate-700",children:g})]}),S&&e.jsx("div",{className:"text-xs text-rose-600",children:S})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("label",{className:"text-xs font-bold text-slate-500 uppercase",children:[i?"重置密码 (选填)":"初始密码"," ",!i&&e.jsx("span",{className:"text-rose-500",children:"*"})]}),e.jsx("input",{type:"password",required:!i,className:"w-full px-3 py-2.5 bg-slate-50 border border-slate-200 rounded-xl focus:bg-white focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 outline-none transition-all text-sm",placeholder:i?"若不修改请留空":"设置初始登录密码",value:t.password,onChange:s=>n({...t,password:s.target.value})})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase",children:"职称"}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{className:"w-full px-3 py-2.5 bg-slate-50 border border-slate-200 rounded-xl focus:bg-white focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 outline-none transition-all text-sm appearance-none",value:t.title,onChange:s=>n({...t,title:s.target.value}),children:[e.jsx("option",{value:"助教",children:"助教"}),e.jsx("option",{value:"讲师",children:"讲师"}),e.jsx("option",{value:"副教授",children:"副教授"}),e.jsx("option",{value:"教授",children:"教授"})]}),e.jsx("div",{className:"absolute right-3 top-3 text-slate-400 pointer-events-none",children:e.jsx(E,{size:14})})]})]}),e.jsxs("div",{className:"pt-4 flex justify-end gap-3 border-t border-slate-100 mt-2",children:[e.jsx("button",{type:"button",onClick:()=>o(!1),className:"px-5 py-2.5 text-slate-600 hover:bg-slate-100 rounded-xl text-sm font-bold transition-colors",children:"取消"}),e.jsxs("button",{type:"submit",disabled:h,className:"px-6 py-2.5 bg-indigo-600 text-white rounded-xl text-sm font-bold hover:bg-indigo-700 transition-all shadow-lg shadow-indigo-200 flex items-center gap-2 disabled:opacity-70 disabled:cursor-not-allowed",children:[h?e.jsx(I,{className:"w-4 h-4 animate-spin"}):e.jsx(X,{size:16}),h?"保存中...":"保存信息"]})]})]})]})})})]})};export{de as default};
